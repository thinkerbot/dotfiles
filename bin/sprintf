#!/usr/bin/env ruby
begin
require 'optparse'
format = ARGV.first

OptionParser.new do |opts|
  opts.banner = %{
Usage: #{$0} [options] [FORMAT]

  Print stdin using the specified sprintf format.  Use the options to specify
  common formats.  By default the input is not changed (equivalent to -c).

Options:
}.lstrip

  opts.on("-b", "binary output") do
    format = "%b"
  end

  opts.on("-x", "hex output") do
    format = "%x "
  end

  opts.on("-o", "octal output") do
    format = "%o "
  end

  opts.on("-c", "string output") do
    format = "%c"
  end

  opts.on("-h", "--help", "print this help") do
    puts opts
    puts
    exit
  end

end.parse!

format ||= "%c"
while b = $stdin.getbyte
  print format % b
end

rescue(Errno::EPIPE)
  raise if $DEBUG
  if $!.class == Errno::EPIPE
    exit 0
  else
    puts "#{$!.message} (see '#{$0} --help')"
    exit 1
  end
end

